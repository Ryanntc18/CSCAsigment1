
@{
    ViewBag.Title = "Sub";
}

@section Scripts{
    <script src="https://polyfill.io/v3/polyfill.min.js?version=3.52.1&features=fetch"></script>
    <script src="https://js.stripe.com/v3/"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
            integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
            crossorigin="anonymous"></script>
    <script type="text/javascript" src="/Scripts/client.js"></script>
    <script type="text/javascript">
        // Create an instance of the Stripe object with your publishable API key
        onload();

        function showAll(a) {
            $("#loadinggif").prop("hidden", true);
            $("#view").prop("hidden", false);


            if (a == 1) {
                $("button").prop("disabled", false);
            };

            if (a == 2) {
                $("#createview").prop("hidden", false);
            };

        }

        function displayload() {
            $("#loadinggif").prop("hidden", false);
            $("#view").prop("hidden", true);
        }

        function onload() {
            $.get("/api/checksub", function (data) {
                console.log("Name onload: " + data.Name);
                console.log("Id onload: " + data.Id);

                if (data.Name == "Netflix Basic") {
                    $("#version").html(data.Name);
                    $("#basicBtn").hide();
                    showAll(1);
                }

                if (data.Name == "Netflix Enhanced") {
                    $("#version").html(data.Name);
                    $("#enhanceBtn").hide();
                    showAll(1);
                }

                if (data.Name == "None") {
                    $("#version").html(data);
                    showAll(2);
                    $(".createBtn").prop("disabled", false);
                }

                if (data.Name == null) {
                    $("#version").html("There was an error no data recieved.");
                    showAll(0)
                }

            });

        }

        // Cancel sub
        function cancel() {
            displayload();

            $.get("/api/checksub", function (data) {

                $.ajax({
                    type: "POST",
                    url: "/api/cancelsub",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify(data),
                    success: function (response) {
                        console.log(response);
                        alert("Subscribtion Deleted succesfully:");
                        window.location.reload();
                    },
                    error: function (response) {
                        alert("There was an error: " + response);
                        console.log(response);
                        $("#version").html("There was an error with the webpage. Please reload");
                        showAll(0);
                    }
                });
            });


        }

        // Create Sub
        function create() {
            displayload();
            $.get("/api/createsub", function (data) {
                if (data != null) {
                    alert("Subscription Started!")
                    window.location.reload();
                }

            });
        }

        // Update Sub
        function update(a) {
            displayload();

            var sub = {
                Name: "",
                Id: ""
            };

            var subid = "some data"

            var updateType = "none";
            //var updateDate = "none";

            if (a == 0) {
                updateType = "Netflix Basic"
            }

            if (a == 1) {
                updateType = "Netflix Enhanced"
            }

            $.get("/api/checksub", function (data) {
                console.log("inside update name: " + data.Name);
                console.log("inside update id: " + data.Id);
                subid = data.Id;
                sub.Name = updateType;
                sub.Id = subid;
                console.log(subid);

                $.ajax({
                    type: "POST",
                    url: "/api/updatesub",
                    contentType: "application/json",
                    dataType: "json",
                    data: JSON.stringify(sub),
                    success: function (response) {
                        console.log(response);
                        alert("Subscribtion updated succesfully:");
                        window.location.reload();
                    },
                    error: function (response) {
                        alert("There was an error");
                        console.log(response);
                        $("#version").html("There was an error with the webpage. Please reload");
                        showAll(0);
                    }
                });

            });

        }

    </script>
}


<div class="row">

    <div class="col-6">
        <h2>Fake NetfLix</h2>
        <h3>Current Version: </h3>
        <br />
        <img id="loadinggif" src="/loading.gif" alt="Loading" />
        <div id="view" hidden>
            <h4 id="version"></h4>
            <br />
            <button id="enhanceBtn" onclick="update(1)" disabled>Updgrade Plan to Enhanced version</button>
            <br />
            <button id="basicBtn" onclick="update(0)" disabled>Downgrade Plan to Basic version</button>
            <br />
            <button id="cancelBtn" onclick="cancel()" disabled>Cancel Plan</button>
            <br />
            <div id="createview" hidden>
                <h3>Start Subscription for Netflix Basic 10SGD/day</h3>

                <button id="createBtn" onclick="create()">Start</button>
            </div>

            <br />
            <button style="margin-top:10px;"><a href="/Home/Charge">Back</a></button>

        </div>

    </div>

</div>


